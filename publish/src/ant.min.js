/*! ant - v1.0.0 - 2014-12-04
* https://github.com/taliu/ant
* Copyright (c) 2014 taliu; Licensed MIT */

function createTable(a,b){for(var c=$("<table>"),d=0;a>d;d++){for(var e=$("<tr>"),f=0;b>f;f++){var g=$("<td>"),h=1;g.attr({id:d+"_"+f,row:d,col:f,value:h,colors:"",obstacle:"no",destination:"no"}),g.css({opacity:h/OPACITY_MAX}),g[0].style.backgroundColor=PATH_COLOR,e.append(g)}c.append(e)}return c}function changeTdColor(a,b){var c=$(a);if(b){var d=c.attr("colors"),e=c[0].style.backgroundColor;d=d?d+","+e:e,c.attr("colors",d),c[0].style.backgroundColor=b,c.css({opacity:1})}else{var f=c.attr("colors").split(",");b=f.pop()||PATH_COLOR,c[0].style.backgroundColor=b,b===PATH_COLOR&&c.css({opacity:+c.attr("value")/OPACITY_MAX}),c.attr("colors",f.join(","))}}function addTdValue(a,b){var c=$(a);"yes"!==c.attr("home")&&c.attr("value",b+parseInt(c.attr("value")))}function isDestinationTd(a){var b=$(a).attr("destination");return"yes"===b}function getRandomNum(a){return Math.random()*a}function Ant(a){function b(a){for(var b=0;b<a.length;b++)if(a[b]){var d=c(a,b);if(-1!==d)for(var e=b+1;d>=e;e++)a[e]=null}var f=[];for(b=0;b<a.length;b++)a[b]&&f.push(a[b]);return console.log("路径优化前:",a.length,"优化后:",f.length),f}function c(a,b){for(var c=a.length;c--;)if(a[c]&&c>b&&a[c].row===a[b].row&&a[c].col===a[b].col)return c;return-1}this.init=function(a){this.color=a,this.row=HOME_ROW,this.col=HOME_COL,this.status=AntStatus.search,this.paths=[],this.speed=1*SPEED,this.frameCount=0,this.varyStep=1},this.init(a),this.canRun=function(){return this.frameCount++,this.frameCount>=this.speed?(this.frameCount=0,!0):!1},this.run=function(){this.status===AntStatus.success&&this.init(this.color);var a=this.getIdSeletor();changeTdColor(a);var c=this.getNextPos();c||console.log(c,this),this.status===AntStatus.search&&this.paths.push({row:this.row,col:this.col}),this.row=c.row,this.col=c.col,a=this.getIdSeletor(),changeTdColor(a,this.color),this.status===AntStatus.found?addTdValue(a,this.varyStep):addTdValue(a,0),isDestinationTd(a)&&(this.status=AntStatus.found,this.paths=b(this.paths),minStep?this.paths.length<minStep?(this.varyStep=10*(minStep-this.paths.length)+addStep,addStep+=this.varyStep,minStep=this.paths.length,console.log("最段距离:",minStep,"增加量：",addStep)):Math.abs(this.paths.length-minStep)<5&&(this.varyStep=1):(minStep=this.paths.length,this.varyStep=1)),this.status===AntStatus.found&&this.isHome()&&(this.status=AntStatus.success),$("#pathsMsg").text(minStep)},this.getNextPos=function(){if(this.status===AntStatus.found)return this.paths.pop();var a=[];for(var b in Direction){var c=this.getPosVal(Direction[b]);c&&a.push(c)}if(0===a.length){var d=this.paths[this.paths.length-1],e=this.getIdSeletor(d.row,d.col);return{row:d.row,col:d.col,value:+$(e).attr("value")}}var f=this.getTotal(a,a.length-1);f+=BASE_TOTAL;for(var g=getRandomNum(f),h=0;h<a.length;h++)if(a[h]&&this.getTotal(a,h-1)<=g&&g<this.getTotal(a,h))return a[h];var i=Math.floor(getRandomNum(a.length));return a[i]},this.getTotal=function(a,b){for(var c=0,d=0;d<a.length&&b>=d;d++)c+=a[d].value;return c},this.getPosVal=function(a){var b=this.row,c=this.col;switch(a){case Direction.up:b-=1;break;case Direction.down:b+=1;break;case Direction.left:c-=1;break;case Direction.right:c+=1;break;case Direction.upRight:c+=1,b-=1;break;case Direction.rightDown:c+=1,b+=1;break;case Direction.downLeft:c-=1,b+=1;break;case Direction.leftUp:c-=1,b-=1}if(b>=0&&ROW>b||(b=this.row),c>=0&&COL>c||(c=this.col),this.row===b&&this.col===c)return null;for(var d=Math.min(COL,ROW),e=1;d>e;e++){var f=this.paths[this.paths.length-e];if(f&&b===f.row&&c===f.col){if(d/2>e)return null;if(getRandomNum(2)>=1)return null}}var g=this.getIdSeletor(b,c);return"yes"===$(g).attr("obstacle")?null:{row:b,col:c,value:+$(g).attr("value")}},this.getIdSeletor=function(a,b){a=a||this.row,b=b||this.col;var c="#"+a+"_"+b;return c},this.isHome=function(){return this.row===HOME_ROW&&this.col===HOME_COL}}function run(){for(var a=0;a<antList.length;a++){var b=antList[a];b.canRun()&&b.run()}requestAnimFrame(run)}function createAnts(a){antList.push(new Ant("red"));var b=setInterval(function(){if(antList.length>=a)return void clearInterval(b);var c=["red","yellow","blue"],d=c[parseInt(getRandomNum(c.length))];antList.push(new Ant(d))},1e3)}function main(){requestAnimFrame(run),createAnts(ANT_TOTAL)}var ROW=30,COL=30,HOME_ROW=0,HOME_COL=0,DESTINATION_ROW=ROW-1,DESTINATION_COL=COL-1,SPEED=0,PATH_COLOR="green",OPACITY_MAX=1e4,BASE_TOTAL=100,ANT_TOTAL=10,AntStatus={search:1,found:2,success:4},Direction={up:38,down:40,left:37,right:39,upRight:3839,rightDown:3940,downLeft:4037,leftUp:3738},antList=[],minStep=0,addStep=10,requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();$(function(){$("#begin").on("click",function(){$("table")[0]||$("#createTable").click(),$("#antSpeed").change(),$("#antNum").change(),$("#setting").hide(),$("#showMsg").show(),main()}),$("#createTable").on("click",function(){$("table").remove(),ROW=parseInt($("#tableRow").val())||30,COL=parseInt($("#tableCol").val())||30,$("#tableRow").val(ROW),$("#tableCol").val(COL),$("#tableSize").text(ROW+"x"+COL);var a=createTable(ROW,COL);$("body").append(a),HOME_ROW=0,HOME_COL=0,DESTINATION_ROW=ROW-1,DESTINATION_COL=COL-1,$("#"+DESTINATION_ROW+"_"+DESTINATION_COL).css({opacity:1}).attr({destination:"yes",value:OPACITY_MAX}).text("食"),$("#"+HOME_ROW+"_"+HOME_COL).css({opacity:1}).attr({home:"yes",value:OPACITY_MAX}).text("洞"),$("td").on("click",function(){var a=$("#select").val(),b=$(this);if(1===a)"yes"!==b.attr("destination")&&"yes"!==b.attr("home")&&("yes"===b.attr("obstacle")?(b.attr("obstacle","no"),b.css({opacity:1/OPACITY_MAX}),b[0].style.backgroundColor=PATH_COLOR):(b.attr("obstacle","yes"),b.css({opacity:1}),b[0].style.backgroundColor="black"));else if(2===a){if("yes"===b.attr("obstacle"))return;$("#"+HOME_ROW+"_"+HOME_COL).css({opacity:1/OPACITY_MAX}).attr({home:"no",value:1}).text(""),HOME_ROW=+b.attr("row"),HOME_COL=+b.attr("col"),$("#"+HOME_ROW+"_"+HOME_COL).css({opacity:1}).attr({home:"yes",value:OPACITY_MAX}).text("洞")}else if(3===a){if("yes"===b.attr("obstacle"))return;$("#"+DESTINATION_ROW+"_"+DESTINATION_COL).css({opacity:1/OPACITY_MAX}).attr({destination:"no",value:1}).text(""),DESTINATION_ROW=+b.attr("row"),DESTINATION_COL=+b.attr("col"),$("#"+DESTINATION_ROW+"_"+DESTINATION_COL).css({opacity:1}).attr({destination:"yes",value:OPACITY_MAX}).text("食")}})}),$("#antSpeed").on("keyup",function(){var a=parseInt(this.value);a>5&&0>a&&(a=5),SPEED=16*(5-a)}).on("change",function(){this.value=5-SPEED/16,$("#antSpeedMsg").text(this.value)}),$("#antNum").on("keyup",function(){ANT_TOTAL=parseInt(this.value)||10}).on("change",function(){this.value=ANT_TOTAL,$("#antNumMsg").text(ANT_TOTAL)})});
//# sourceMappingURL=publish/src/ant.min.js.map